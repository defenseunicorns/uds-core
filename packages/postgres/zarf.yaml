kind: ZarfPackageConfig
metadata:
  name: ha-dev
  description: "UDS HA Development Package"
  authors: "Defense Unicorns - Product"
  version: "dev"

components:
  - name: postgres-dev
    required: true
    manifests:
      - name: postgres-dev
        files:
          - manifests/postgres.yaml
    actions:
      onDeploy:
        after:
          - wait:
              cluster:
                kind: Postgresql
                name: postgresql
                namespace: keycloak
                condition: "'{.status.PostgresClusterStatus}'=Running"
            maxTotalSeconds: 600
          - cmd: uds zarf tools kubectl get secret keycloak.postgresql.credentials.postgresql.acid.zalan.do -n keycloak -o jsonpath='{.data.username}' | base64 --decode
            setVariables:
              - name: DATABASE_USERNAME
          - cmd: uds zarf tools kubectl get secret keycloak.postgresql.credentials.postgresql.acid.zalan.do -n keycloak -o jsonpath='{.data.password}' | base64 --decode
            setVariables:
              - name: DATABASE_PASSWORD
