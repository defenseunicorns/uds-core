name: Lint OSCAL Files

on:
  push:
    paths:
      - '**/*oscal*.yaml'

permissions:
    contents: read

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7

      - name: Identify changed OSCAL files
        id: find_changed_files
        run: |
          CHANGED_FILES=$(git diff --name-only HEAD^ HEAD | grep 'oscal.*\.yaml$' || true)
          echo "Changed OSCAL files: $CHANGED_FILES"
          echo "::set-output name=oscal_files::$CHANGED_FILES"

      - name: Run lint-oscal
        uses: .github/actions/lint-oscal/action.yaml
        with:
          OSCALFILES: ${{ steps.find_changed_files.outputs.oscal_files }}
