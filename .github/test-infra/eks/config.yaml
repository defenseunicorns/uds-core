apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  name: ${CLUSTER_NAME}
  region: us-west-2
  version: "1.27"
  tags:
    PermissionsBoundary: ${PERMISSIONS_BOUNDARY_NAME}

iam:
  withOIDC: true
  serviceRolePermissionsBoundary: ${PERMISSIONS_BOUNDARY_ARN}

addons:
  - name: aws-ebs-csi-driver
    version: v1.25.0-eksbuild.1

    attachPolicyARNs:
      - arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy
    permissionsBoundary: ${PERMISSIONS_BOUNDARY_ARN}
    tags:
      PermissionsBoundary: ${PERMISSIONS_BOUNDARY_NAME}

  - name: vpc-cni
    permissionsBoundary: ${PERMISSIONS_BOUNDARY_ARN}
    tags:
      PermissionsBoundary: ${PERMISSIONS_BOUNDARY_NAME}

managedNodeGroups:
  - name: ng-1
    instanceType: m5.2xlarge
    desiredCapacity: 3
    volumeSize: 150
    tags:
      PermissionsBoundary: ${PERMISSIONS_BOUNDARY_NAME}
    iam:
      instanceRolePermissionsBoundary: ${PERMISSIONS_BOUNDARY_ARN}
    ami: ${AMI_ID}
    amiFamily: AmazonLinux2
    overrideBootstrapCommand: |
      #!/bin/bash
      /etc/eks/bootstrap.sh CLUSTER_NAME --container-runtime containerd
