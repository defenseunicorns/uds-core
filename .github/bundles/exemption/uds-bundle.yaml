kind: UDSBundle
metadata:
  name: exemption-test
  description: A UDS bundle for testing pre core exemptions
  # x-release-please-start-version
  version: "0.21.0"
  # x-release-please-end

packages:
  - name: uds-k3d-dev
    repository: ghcr.io/defenseunicorns/packages/uds-k3d
    # renovate: datasource=github-tags depName=defenseunicorns/uds-k3d versioning=semver
    ref: 0.6.0
    overrides:
      uds-dev-stack:
        minio:
          variables:
            - name: buckets
              description: "Set Minio Buckets"
              path: buckets
            - name: svcaccts
              description: "Minio Service Accounts"
              path: svcaccts
            - name: users
              description: "Minio Users"
              path: users
            - name: policies
              description: "Minio policies"
              path: policies

  - name: init
    repository: ghcr.io/defenseunicorns/packages/init
    # renovate: datasource=github-tags depName=defenseunicorns/zarf versioning=semver
    ref: v0.33.1

  - name: podinfo
    repository: ghcr.io/defenseunicorns/uds-cli/podinfo
    ref: 0.0.1
    overrides:
      podinfo:
        podinfo:
          values:
            - path: securityContext
              value:
                runAsUser: 0
                runAsGroup: 0

  - name: core-slim-dev
    path: ../../../build/
    # x-release-please-start-version
    ref: 0.21.0
    # x-release-please-end
    overrides:
      pre-core-exemptions:
        pre-core-exemptions:
          values:
            - path: enabled
              value: true
            - path: exemptions
              value: |
                - policies:
                    - DisallowPrivileged
                    - RequireNonRootUser
                    - DropAllCapabilities
                  title: "podinfo1"
                  matcher:
                    namespace: podinfo
                    name: "^podinfo.*"
                - policies:
                    - DisallowNodePortServices
                  title: "podinfo2"
                  matcher:
                    namespace: podinfo
                    name: "^.*-local.*"
                    kind: service
