includes:
  - create: ./tasks/create.yaml
  - setup: ./tasks/setup.yaml
  - deploy: ./tasks/deploy.yaml

tasks:
  - name: single-package
    description: "Build and test a single package, must set UDS_PKG environment variable"
    actions:
      - task: create:single-package
      - task: setup:k3d-test-cluster
      - task: deploy:single-package

      - description: "Validate the package"
        cmd: uds run -f src/${UDS_PKG}/validate.yaml run --no-progress

  - name: uds-core
    description: "Build and test UDS Core"
    actions:
      - task: create:standard-package
      #- task: create:istio-package
      - task: create:k3d-standard-bundle
      - task: deploy:k3d-standard-bundle
      - task: validate-all



  - name: validate-all
    description: "Validated all packages"
    actions:
    # loop through each src/* package and run the validate.yaml task
    - cmd: |
        set -e        
        for package in src/*; do
          uds run -f ${package}/validate.yaml run --no-progress
        done
