kind: ZarfPackageConfig
metadata:
  name: farmer-pickles
  url: https://welovebob.com/characters/farmer_pickles.htm
  image: https://welovebob.com/Images/characters/farmer_pickles.jpg
  description: "A zarf package to deploy things"

components:
  - name: deploy
    required: true
    actions:
      onCreate:
        before:
          - description: Deploy the cluster bundle
            cmd: |
                ARCH=$(uname -m)
                [ "$ARCH" = "x86_64" ] && ARCH="amd64"
                # Below package will be have the codebase moved into the org and published under 
                # oci://ghcr.io/defenseunicorns/dev-dependencies/k3d-common-istio
                ./uds deploy oci://ghcr.io/zachariahmiller/k3d-common-istio:0.2.0-$ARCH --no-progress --confirm
            dir: ../build
          - description: Deploy the neuvector
            cmd: |
                ARCH=$(uname -m)
                [ "$ARCH" = "x86_64" ] && ARCH="amd64"
                ./zarf p d ../build/zarf-package-uds-capability-neuvector-$ARCH-2.6.4.tar.zst  --no-progress --confirm        
          - description: Wait for the istio gateway to have the label required for vs generation.
            wait:
              cluster:
                kind: Gateway
                name: uds/istio-domain=admin.uds.dev
                namespace: istio-admin-gateway