# Copyright 2025 Defense Unicorns
# SPDX-License-Identifier: AGPL-3.0-or-later OR LicenseRef-Defense-Unicorns-Commercial

apiVersion: v1
kind: Secret
metadata:
  name: sso-ca-cert
  namespace: istio-system
type: Opaque
{{- if or .Values.cluster.caBundle.certs .Values.cluster.expose.caCert }}
data:
  # Note: This key must be `extra.pem` to ensure that istiod loads and trusts it properly
  # This matches the upstream configmap, see https://github.com/istio/istio/blob/2d5fc65b386ac3c3eff28aee4040dce37923b9b7/manifests/charts/istio-control/istio-discovery/templates/configmap-jwks.yaml
  extra.pem: {{ .Values.cluster.caBundle.certs | default .Values.cluster.expose.caCert | quote }}
{{- end }}
