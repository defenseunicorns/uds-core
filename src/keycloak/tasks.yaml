includes:
  - config: https://raw.githubusercontent.com/defenseunicorns/uds-identity-config/v0.4.3/tasks.yaml

tasks:
  - name: validate
    actions:
      - description: Validate admin interface
        wait:
          network:
            protocol: https
            address: keycloak.admin.uds.dev
            code: 200
      - description: Validate public interface
        wait:
          network:
            protocol: https
            address: sso.uds.dev
            code: 200

  - name: dev-theme
    actions:
      - task: config:dev-theme

  - name: cacert
    actions:
      - task: config:cacert

  - name: dev-cacert
    description: Updates the cacert value in default values files for gateways
    actions:
      - task: config:cacert
      - cmd: |
          yq eval-all --inplace 'select(fileIndex == 0) * select(fileIndex == 1)' src/istio/values/config-tenant.yaml tls_cacert.yaml
          yq eval-all --inplace 'select(fileIndex == 0) * select(fileIndex == 1)' src/istio/values/config-admin.yaml tls_cacert.yaml

  - name: debug-istio-traffic
    actions:
      - task: config:debug-istio-traffic

  - name: regenerate-test-pki
    actions:
      - task: config:regenerate-test-pki
