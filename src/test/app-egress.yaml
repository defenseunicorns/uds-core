# Copyright 2024 Defense Unicorns
# SPDX-License-Identifier: AGPL-3.0-or-later OR LicenseRef-Defense-Unicorns-Commercial

apiVersion: v1
kind: Namespace
metadata:
labels:
  uds: curl-testing-namespace-1
name: curl-ns-egress-gw-1
---
apiVersion: uds.dev/v1alpha1
kind: Package
metadata:
name: curl-pkg-egress-gw
namespace: curl-ns-egress-gw-1
spec:
network:
  allow:
    - direction: Egress
      selector:
        app: curl-pkg-egress-gw
      ports:
        - 443
      remoteHost: httpbin.org
      remoteProtocol: TLS
      description: "Example Curl"
---
apiVersion: v1
kind: Service
metadata:
name: curl-pkg-egress-gw
namespace: curl-ns-egress-gw-1
labels:
  name: curl-pkg-egress-gw
  namespace: curl-ns-egress-gw-1
spec:
ports:
  - name: port8080
    port: 8080
    targetPort: 8080
selector:
  app: curl-pkg-egress-gw
---
apiVersion: apps/v1
kind: Deployment
metadata:
name: curl-pkg-egress-gw
namespace: curl-ns-egress-gw-1
spec:
replicas: 1
selector:
  matchLabels:
    app: curl-pkg-egress-gw
template:
  metadata:
    labels:
      app: curl-pkg-egress-gw
    annotations:
      sidecar.istio.io/proxyCPU: "10m"
      sidecar.istio.io/proxyMemory: "16Mi"
  spec:
    containers:
      - name: curl-pkg-egress-gw
        image: curlimages/curl
        imagePullPolicy: IfNotPresent
        command: ["sleep", "3600"]
        resources:
          limits:
            cpu: 50m
            memory: 64Mi
          requests:
            cpu: 10m
            memory: 16Mi
        ports:
          - containerPort: 8080
---
