variables:
  - name: PODINFO_NAME

tasks:
  - name: validate
    actions:
      - description: Validate exemptions are applied
        wait:
          cluster:
            kind: exemption
            name: pre-core-exemptions
            namespace: uds-policy-exemptions
            condition: exists

      - description: Get podinfo name
        cmd: echo $(uds zarf tools kubectl get pods -n podinfo -o jsonpath='{.items[0].metadata.name}')
        setVariables:
          - name: PODINFO_NAME

      - description: Cycle podinfo
        cmd: uds zarf tools kubectl delete pod -n podinfo ${PODINFO_NAME}

      - description: Check for podinfo to come back up
        wait:
          cluster:
            kind: Pod
            name: $PODINFO_NAME
            namespace: podinfo
