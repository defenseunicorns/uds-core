# Copyright 2025 Defense Unicorns
# SPDX-License-Identifier: AGPL-3.0-or-later OR LicenseRef-Defense-Unicorns-Commercial

# Disable automatic update/loading of Falco default rules for airgapped environments
falcoctl:
  artifact:
    install:
      enabled: false
    follow:
      enabled: false
driver:
  kind: modern-bpf

# work around for: https://github.com/falcosecurity/charts/issues/888
falco:
  config_files:
    - /dummy

  # Send to Falco Sidekick
  # http_output:
  #   enabled: true
  #   echo: true
  #   url: http://falcosidekick:2801 # URL of the Falco Sidekick service from the sidekick chart

falcosidekick:
  enabled: true

  serviceMonitor:
    enabled: true
  grafana:
    # Dashboard for Falcosidekick metrics
    dashboards:
      enabled: true

  config:
    # Logs alerts/payloads to stdout
    # This should be ok to keep on by default so that users can see events logged to falcosidekick without needing to set up an external destination
    # If you setup a forwarding destination (https://falco.org/docs/concepts/outputs/forwarding/) you may want to disable this
    debug: true

    # Set this to enable sending alerts to Alertmanager
    # alertmanager:
    #   hostport: "http://kube-prometheus-stack-alertmanager.monitoring.svc.cluster.local:9093"
    #   endpoint: "/api/v2/alerts"

    # Send alert events to loki by default
    # This creates a cleaner stream of alert events for querying rather than looking at pod logs
    loki:
      hostport: "http://loki-gateway.loki.svc.cluster.local:80"
      format: json
      grafanaDashboard:
        enabled: true
        configmap:
          folder: "Falco"

# Enable Grafana dashboards
grafana:
  dashboards:
    enabled: true

# Enable metrics
metrics:
  enabled: true

# Enable serviceMonitor
serviceMonitor:
  create: true

# Enable Prometheus metrics endpoint
webserver:
  prometheus_metrics_enabled: true
