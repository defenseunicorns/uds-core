apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: {{ .Values.uuid }}
webhooks:
  - admissionReviewVersions:
      - v1
      - v1beta1
    clientConfig:
      caBundle: >-
        LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlDdERDQ0FaeWdBd0lCQWdJQkFUQU5CZ2txaGtpRzl3MEJBUXNGQURBY01Sb3dHQVlEVlFRREV4RlFaWEJ5DQpJRVZ3YUdWdFpYSmhiQ0JEUVRBZUZ3MHlOakF4TVRNeU1ERXhNemxhRncweU56QXhNVE15TURFeE16bGFNQUF3DQpnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFEREYxM0NmK3g3eThFMklXaHRRQW1xDQpraDZMajl5SXlFZ0lyL0I5SG8zTEptMFhweUR5eTBhd2hQYkpuZVlCOWJHMUlHQ0M4VXBXNEk2N3ozUENRZjlZDQpBclNjQUcvQXJ2L2d6RzBmTWdnVTVOTWVuNGwyMWdzM3NuU3B2WG5jd05mYnZyVWVtS2crT1hVV0c3WVE3QlZVDQpEK3RWOUZWSDJiUzdPSDQ2anZLYmFYdHZ0aDNRaWhMUHozOTIvVzJGSG9CYzBXc2ZKd3F1TzRFRW9YTHJ2eGlxDQpZbzBIb2JySWdhYzJEbXM0eXZvTVVuUDFiVUpqNTM2cGJxc1hGckxnQjR6WUtjV2ZyWFp4aTlMR2h4L21JU09DDQpMUjNlTy9mRmNwRW9jVks1QktiTFErQlNZd2VCbnRqdW03ZnpOS05Vci9kTkc5bXVSUkQ1UGp1cE92Mm9IcWh0DQpBZ01CQUFHakhUQWJNQXdHQTFVZEV3UUZNQU1CQWY4d0N3WURWUjBQQkFRREFnTDBNQTBHQ1NxR1NJYjNEUUVCDQpDd1VBQTRJQkFRQzk2QlBzVUo3emc3cHpGRUNzV0ROdlF2T1E5ZEVXSnp5NjBNQ1Mvdy9hd2NxSzFNSXN2MXBIDQozY3JTMXU4cGwrNXRWMEp0NnB0YnJCaFFZUUFVQnVmV2NFKzRHVUJFelk4ejlpbzZ3d2dMeDFkdzR2SEFzSzF1DQpiSitqUXR5d1Y5dlZnTEM3Q1NacVlFYXRpdjU4Z2YwMXM1UWdqZnU1dk03YlJZcmZlYTlycTRpK1dkcG1YRU1uDQpTdnhsZ1daRDE0TGRXTE9mOXBrUGcxR1dIbUNCckdyQnQ0M1JpRi9mQStPYzZBUzhGVENJQVZBL3lMMlU2V2pPDQppYi91M1VBcnA2L3pscGR3YXNFekxlM201dVR0Q0lQOEZhQUs1ZTJnZGswUGpnK0VNVHF0NkJsdE91WjRPWmd3DQpMMnN6OXYrL2pReVhDQkhzSmJ4d04wd0cxQllKbFZkUQ0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ0K
      service:
        name: {{ .Values.uuid }}
        namespace: pepr-system
        path: >-
          /mutate/bf8cf77563d2148dc36b2cc22ef699b0bcab573a328e97866989e00153754e82
    failurePolicy: {{ .Values.admission.failurePolicy }}
    matchPolicy: Equivalent
    name: {{ .Values.uuid }}.pepr.dev
    namespaceSelector:
      matchExpressions:
        - key: kubernetes.io/metadata.name
          operator: NotIn
          values:
            - kube-system
            - pepr-system
            {{- range .Values.additionalIgnoredNamespaces }}
            - {{ . }}
            {{- end }}
            - zarf
            - istio-system
    rules:
      - apiGroups:
          - ''
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - services
      - apiGroups:
          - ''
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - pods
          - pods/ephemeralcontainers
      - apiGroups:
          - uds.dev
        apiVersions:
          - v1alpha1
        operations:
          - '*'
        resources:
          - packages
      - apiGroups:
          - monitoring.coreos.com
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - servicemonitors
      - apiGroups:
          - monitoring.coreos.com
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - podmonitors
    sideEffects: None
    timeoutSeconds: 10
  - admissionReviewVersions:
      - v1
      - v1beta1
    clientConfig:
      caBundle: >-
        LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlDdERDQ0FaeWdBd0lCQWdJQkFUQU5CZ2txaGtpRzl3MEJBUXNGQURBY01Sb3dHQVlEVlFRREV4RlFaWEJ5DQpJRVZ3YUdWdFpYSmhiQ0JEUVRBZUZ3MHlOakF4TVRNeU1ERXhNemxhRncweU56QXhNVE15TURFeE16bGFNQUF3DQpnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFEREYxM0NmK3g3eThFMklXaHRRQW1xDQpraDZMajl5SXlFZ0lyL0I5SG8zTEptMFhweUR5eTBhd2hQYkpuZVlCOWJHMUlHQ0M4VXBXNEk2N3ozUENRZjlZDQpBclNjQUcvQXJ2L2d6RzBmTWdnVTVOTWVuNGwyMWdzM3NuU3B2WG5jd05mYnZyVWVtS2crT1hVV0c3WVE3QlZVDQpEK3RWOUZWSDJiUzdPSDQ2anZLYmFYdHZ0aDNRaWhMUHozOTIvVzJGSG9CYzBXc2ZKd3F1TzRFRW9YTHJ2eGlxDQpZbzBIb2JySWdhYzJEbXM0eXZvTVVuUDFiVUpqNTM2cGJxc1hGckxnQjR6WUtjV2ZyWFp4aTlMR2h4L21JU09DDQpMUjNlTy9mRmNwRW9jVks1QktiTFErQlNZd2VCbnRqdW03ZnpOS05Vci9kTkc5bXVSUkQ1UGp1cE92Mm9IcWh0DQpBZ01CQUFHakhUQWJNQXdHQTFVZEV3UUZNQU1CQWY4d0N3WURWUjBQQkFRREFnTDBNQTBHQ1NxR1NJYjNEUUVCDQpDd1VBQTRJQkFRQzk2QlBzVUo3emc3cHpGRUNzV0ROdlF2T1E5ZEVXSnp5NjBNQ1Mvdy9hd2NxSzFNSXN2MXBIDQozY3JTMXU4cGwrNXRWMEp0NnB0YnJCaFFZUUFVQnVmV2NFKzRHVUJFelk4ejlpbzZ3d2dMeDFkdzR2SEFzSzF1DQpiSitqUXR5d1Y5dlZnTEM3Q1NacVlFYXRpdjU4Z2YwMXM1UWdqZnU1dk03YlJZcmZlYTlycTRpK1dkcG1YRU1uDQpTdnhsZ1daRDE0TGRXTE9mOXBrUGcxR1dIbUNCckdyQnQ0M1JpRi9mQStPYzZBUzhGVENJQVZBL3lMMlU2V2pPDQppYi91M1VBcnA2L3pscGR3YXNFekxlM201dVR0Q0lQOEZhQUs1ZTJnZGswUGpnK0VNVHF0NkJsdE91WjRPWmd3DQpMMnN6OXYrL2pReVhDQkhzSmJ4d04wd0cxQllKbFZkUQ0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ0K
      service:
        name: {{ .Values.uuid }}
        namespace: pepr-system
        path: >-
          /mutate/bf8cf77563d2148dc36b2cc22ef699b0bcab573a328e97866989e00153754e82
    failurePolicy: Ignore
    matchPolicy: Equivalent
    name: {{ .Values.uuid }}-istio-system.pepr.dev
    namespaceSelector:
      matchExpressions:
        - key: kubernetes.io/metadata.name
          operator: In
          values:
            - istio-system
    rules:
      - apiGroups:
          - ''
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - services
      - apiGroups:
          - ''
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - pods
          - pods/ephemeralcontainers
      - apiGroups:
          - uds.dev
        apiVersions:
          - v1alpha1
        operations:
          - '*'
        resources:
          - packages
      - apiGroups:
          - monitoring.coreos.com
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - servicemonitors
      - apiGroups:
          - monitoring.coreos.com
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - podmonitors
    sideEffects: None
    timeoutSeconds: 10
